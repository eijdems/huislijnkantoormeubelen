<?php 
$helper = $this->helper('Emizen\Customsearch\Helper\Data');
$checkLogin = $helper->getCustomLogin(); 
?>

<?php if ($checkLogin) : ?>
    <?php
        $product = $block->getProduct();
        $pId = $product['entity_id'];
        $_helper = $this->helper('FME\Productattachments\Helper\Data'); 
        $attachmentData = $_helper->getProductAttachmentsById($pId);
        $parentCategoryId = 3; // specify the parent category ID

        // Fetch child categories using getSubCategories()
        $childCategories = $_helper->getSubCategories($parentCategoryId);
    ?>

    <?php if ($childCategories->count()) : ?>
        <?php foreach ($childCategories as $childCategory) : ?>
            <?php 
                $childCategoryId = $childCategory->getId(); 
                $childCategoryName = $childCategory->getCategoryName(); // Get category name

                // Filter attachments for this child category
                $filteredAttachments = array_filter($attachmentData, function($attachment) use ($childCategoryId) {
                    return $attachment['cat_id'] == $childCategoryId;
                });
            ?>

            <?php if (!empty($filteredAttachments)) : ?>
                <h3 class="fme_image"><?php echo $childCategoryName; ?></h3>
                <div class="attachments-container">
                    <?php foreach ($filteredAttachments as $attachment) : ?>
                        <?php $fileType = $attachment['file_type']; ?>
                        <?php if (in_array($fileType, ["jpg", "jpeg", "png"])) : ?>
                            <div class="img-attachment">
                                <a href="<?php echo $attachment['download_link']; ?>" data-lightbox="gallery" data-title="<?php echo $attachment['title']; ?>">
                                    <!-- <img src="<?php //echo $attachment['download_link']; ?>" alt="<?php //echo $attachment['title']; ?>"> -->
                                    <span class="attach-text"><?php echo $attachment['title']; ?></span>
                                </a>
                            </div>
                        <?php else : ?>
                            <div class="img-dwg">
                                <a href="<?php echo $attachment['download_link']; ?>" target="_blank">
                                    <?php 
                                    $blockObj = $block->getLayout()->createBlock('FME\Productattachments\Block\Productattachments');
                                    $fileIcon = $blockObj->getnewicon($attachment['file_type']);
                                    echo /*$fileIcon . " " . */$attachment['title']; 
                                    ?>
                                </a>
                            </div>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>
        <?php endforeach; ?>
    <?php else : ?>
        <p>Binnenkort beschikbaar</p>
    <?php endif; ?>
<?php endif; ?>
